{% extends "broker/list.html" %}

{% block model_list %}
	{% if listings %}
		<thead>
			<tr>
				<th scope="col">ID</th>
				<th scope="col">Type</th>
				<th scope="col">Available On</th>
				<th scope="col">Price</th>
				<th scope="col">Description</th>
				<th scope="col">Address</th>
				<th scope="col">Size</th>
				<th scope="col">Rooms</th>
			</tr>
		</thead>
		<tbody id="listings-table-body">
		{% for listing in listings %}
			<tr onclick="toggleSuggestions(
				{% comment %}
				This function will trigger an Ajax call, which sends a request to the Rest API.
				Here we build the JS-Object that the client will send to the Rest Server at /rest/seekings/.
				The endpoint there will call broker.utils.filter_search_seeking, which supports these fields:
					- seeking_type
					- max_rent
					- min_rent
					- max_purchase_price
					- min_purchase_price
					- min_number_of_rooms
					- max_number_of_rooms
					- min_size_sq_m
					- max_size_sq_m
					- min_number_of_persons
					- max_number_of_persons
					- min_starting_date
					- max_starting_date
					- min_ending_date
					- max_ending_date
					- min_number_of_months
					- max_number_of_months
					- must_be_furnished
					- must_have_internet
					- is_smoker
					- has_pets
					- min_age (derived from seeking.contact.date_of_birth)
					- max_age (derived from seeking.contact.date_of_birth)
				{% endcomment %}
				'listing',
				{{ listing.id }},
				{
			    		'seeking_type': '{{ listing.listing_type }}',
			    		{% if listing.listing_type == 'rental' %}
			    			'min_rent': '{{ listing.rental_price }}',
			    		{% elif listing.listing_type == 'for_sale' %}
			    			'min_purchase_price': '{{ listing.for_sale_price }}',
			    		{% endif %}

			    		'max_number_of_rooms': '{{ listing.apartment.number_of_rooms }}',
					'max_size_sq_m': '{{ listing.apartment.size_sq_m }}',
			    		{% comment %}
			    		See Feature #368
			    		See Feature #383
			    		{% endcomment %}
			    		'max_number_of_persons': ' {{ listing.number_of_people }}',

			    		{% comment %}
			    		// TODO: Figure out the business logic around starting and ending date
					// min_starting_date
					// max_starting_date
					// min_ending_date
					// max_ending_date
					// min_number_of_months
					// max_number_of_months
			    		{% endcomment %}

			    		{% if listing.apartment.is_furnished is False %}
			    			'must_be_furnished': 'False',
			    		{% endif %}
			    		{% if listing.apartment.has_internet is False %}
			    			'must_have_internet': 'False',
			    		{% endif %}
			    		{% if listing.pets_ok is False %}
			    			'has_pets': 'False',
			    		{% endif %}

			    		{% comment %}
			    		// TODO: Be ageist? Discriminate smokers?
					// is_smoker
					// min_age
					// max_age
			    		{% endcomment %}
				});" class="broker-row"
			>
				<td>{{ listing.id }}</td>
				<td>{{ listing.listing_type }}</td>
				<td>{{ listing.date_available }}</td>
				{% if listing.listing_type == 'rental' %}
					<td>{{ listing.rental_price }}</td>
				{% elif listing.listing_type == 'for_sale' %}
					<td>{{ listing.for_sale_price }}</td>
				{% endif %}
				<td>{{ listing }}</td>
				<td>{{ listing.apartment.house.real_estate.address }}</td>
				<td>{{ listing.apartment.size_sq_m }}m<sup>2</sup></td>
				<td>{{ listing.apartment.number_of_rooms }}</td>
			</tr>
			<tr id="suggestions-row-listing{{ listing.id }}" class="suggestions-row">
			</tr>
		{% endfor %}
		</tbody>
	{% else %}
		No listings found!
	{% endif %}
{% endblock %}
